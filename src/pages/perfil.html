<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fluker - Perfil</title>

  <!-- Favicon -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/Logo-Fluker.png') }}" type="image/x-icon" />

  <!-- CSS principal -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/stylePerfil.css') }}" />

  <!-- React 18 via CDN (ambiente de desenvolvimento) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>

<body>
  <!-- Cabeçalho: logo, atalho para home, busca, notificações e menu do usuário -->
  <header>
    <div class="header-left">
      <!-- Logo da aplicação -->
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo FLUKER" class="logo" />

      <!-- Título central que navega para /home -->
      <button class="title-center" onclick="window.location.href = '/home'">
        FLUKER
      </button>
    </div>

    <!-- Área de ações do usuário: busca, notificações e perfil -->
    <div class="user-menu">
      <!-- Botão para abrir modal de busca de usuários -->
      <div class="search-users-wrapper" onclick="openUserSearchModal()">
        <img src="{{ url_for('static', filename='images/Lupa.png') }}" alt="Buscar usuários" class="icone-busca" />
      </div>

      <!-- Sino de notificações com indicador de não lidas -->
      <div class="bell-wrapper" onclick="openNotificationsModal()">
        <img src="{{ url_for('static', filename='images/sino.png') }}" alt="Notificações" class="icone-sino" />
        <span id="notif-badge" class="notif-badge"></span>
      </div>

      <!-- Avatar com dropdown de ações (perfil/sair) -->
      <img src="{{ url_for('static', filename='images/perfil.jpg') }}" alt="Perfil" class="perfil-topo"
        onclick="toggleUserMenu()" />
      <div class="menu-dropdown hidden" id="user-dropdown">
        <ul>
          <li><a href="{{url_for('perfil_page')}}" method="GET">Meu Perfil</a></li>
          <li onclick="logout()">Sair</li>
        </ul>
      </div>
    </div>
  </header>
  <div class="banner">
  <img src="{{ url_for('static', filename='images/banner-exemplo.jpg') }}" alt="Banner" class="banner-img">
  <div class="banner-overlay"></div>
</div>
  <!-- Layout principal -->
  <div class="layout">
    
    <main>
        <!-- Seção de perfil (mostra meu perfil ou o de outro usuário) -->
        <section id="perfil" class="content">
          <div class="profile perfil-container">
            {% if profile_user %}
            <!-- Perfil de outro usuário -->
            <div class="avatar">
              <img
                src="{{ url_for('static', filename='images/perfil.jpg') }}"
                alt="Foto de perfil"
                class="perfil-principal"
              />
            </div>

            <!-- Nome do usuário visitado -->
            <h2>{{ profile_user.username }}</h2>

            <!-- Estado de amizade e ações relacionadas (se não for meu perfil) -->
            {% if not is_my_profile %} {% if are_we_friends %}
            <p class="friend-status">✅ Amigos</p>
            {% elif has_pending_request %}
            <p class="friend-status">⏳ Solicitação enviada</p>
            {% else %}
            <form
              action="{{ url_for('add_friend', user_id=profile_user.id) }}"
              method="POST"
            >
              <button type="submit" class="add-friend-btn">
                Adicionar Amigo
              </button>
            </form>
            {% endif %} {% endif %}
          </section>

        <section class="perfil" class="content">
          <div class="profile-posts feed-container">

            <!-- Últimos 3 posts do usuário visitado -->
            <h3>Últimos 3 posts:</h3>
            <div class="posts">
              {% if recent_posts %} {% for post in recent_posts %}
              <div class="post">
                <div class="post-header">
                  <small>{{ post.timestamp_display }}</small>
                </div>
                <p>{{ post.content }}</p>
                <div class="post-stats">
                  <span>❤️ {{ post.likes }} curtidas</span>
                </div>
              </div>
              {% endfor %} {% else %}
              <p class="empty">Nenhum post ainda.</p>
              {% endif %}
            </div>

            {% else %}
            <!-- Meu perfil -->
            <div class="avatar">
              <img
                src="{{ url_for('static', filename='images/perfil.jpg') }}"
                alt="Foto de perfil"
                class="perfil-principal"
              />
            </div>

            <!-- Meu nome de usuário -->
            <h2>{{ username }}</h2>

            <!-- Meus últimos 3 posts -->
            <h3>Meus últimos 3 posts:</h3>
            <div class="posts">
              {% if recent_posts %} {% for post in recent_posts %}
              <div class="post">
                <div class="post-header">
                  <small>{{ post.timestamp_display }}</small>
                </div>
                <p>{{ post.content }}</p>
                <div class="post-stats">
                  <span>❤️ {{ post.likes }} curtidas</span>
                </div>
              </div>
              {% endfor %} {% else %}
              <p class="empty">Você ainda não fez nenhum post.</p>
              {% endif %}
            </div>
            {% endif %}
          </div>
        </section>
    </main>

    <!-- Botão flutuante para abrir/fechar o chat (DM) -->
    <button class="chat-button" onclick="toggleChat()">CHAT</button>

    <!-- Caixa/Modal do chat DM (conteúdo é renderizado via React) -->
    <div id="chat-box" class="chat-box hidden">
      <div class="chat-wrapper">
        <div class="chat-header-top">
          <h3>DM</h3>
        </div>
        <div id="dm-chat-root" data-current-user-id="{{ session.get('user_id') }}">
          <!-- React renderiza aqui -->
        </div>
      </div>
    </div>

    <!-- Modal de notificações (lista e ações) -->
    <div id="notifications-modal" class="hidden">
      <div id="notifications-modal-backdrop"></div>
      <div id="notifications-modal-content" role="dialog" aria-modal="true" aria-labelledby="notifications-modal-title">
        <div style="
            display: flex;
            align-items: center;
            justify-content: space-between;
          ">
          <h3 id="notifications-modal-title">Notificações</h3>
          <button id="notifications-modal-close" aria-label="Fechar">×</button>
        </div>
        <div id="notifications-list"></div>
        <button id="mark-all-read" style="margin-top: 8px">
          Marcar todas como lidas
        </button>
      </div>
    </div>

    <!-- Modal de busca de usuários -->
    <div id="user-search-modal" class="hidden">
      <div id="user-search-backdrop"></div>
      <div id="user-search-content" role="dialog" aria-modal="true" aria-labelledby="user-search-title">
        <div style="
            display: flex;
            align-items: center;
            justify-content: space-between;
          ">
          <h3 id="user-search-title">Explorar Usuários</h3>
          <button id="user-search-close" aria-label="Fechar">×</button>
        </div>

        <!-- Campo de busca e área de resultados -->
        <div class="search-box">
          <input autocomplete="off" type="text" id="user-search-input" placeholder="Buscar por nome ou email..." />
          <div id="search-results" class="hidden"></div>
        </div>
      </div>
    </div>


    <!-- Exposição controlada do ID do usuário atual para uso em JS -->
    <script>
      window.CURRENT_USER_ID = "{{ session.get('user_id') }}";
    </script>

    <!-- Scripts legados do projeto -->
    <script src="{{ url_for('static', filename='scripts/script.js') }}"></script>

    <!-- Scripts React/JS da aplicação (ex.: polling para atualizações) -->
    <script src="{{ url_for('static', filename='scripts/reactPolling.js') }}"></script>
</body>

</html>